<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analyse quantitative - M2 Villes et environnements urbains - Séance 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Analyse quantitative - M2 Villes et environnements urbains</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Seance1.html" rel="" target="">
 <span class="menu-text">Séance 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Seance2.html" rel="" target="">
 <span class="menu-text">Séance 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pptS2.html" rel="" target="">
 <span class="menu-text">Powerpoint - Séance 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./rappel_S1S2.html" rel="" target="">
 <span class="menu-text">Rappel avant la troisième séance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Seance3.html" rel="" target="" aria-current="page">
 <span class="menu-text">Séance 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pptS4.html" rel="" target="">
 <span class="menu-text">Powerpoint - Séance 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DM_corrige_code.html" rel="" target="">
 <span class="menu-text">DM d’application - Code complété</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pptS5.html" rel="" target="">
 <span class="menu-text">Powerpoint - Séance 5</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Seance6.html" rel="" target="">
 <span class="menu-text">Séance 6</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#acquis-des-premières-et-deuxièmes-séances-programme-du-jour" id="toc-acquis-des-premières-et-deuxièmes-séances-programme-du-jour" class="nav-link active" data-scroll-target="#acquis-des-premières-et-deuxièmes-séances-programme-du-jour">Acquis des premières et deuxièmes séances, programme du jour</a></li>
  <li><a href="#tris-à-plat-et-tris-croisés-compter-les-unités" id="toc-tris-à-plat-et-tris-croisés-compter-les-unités" class="nav-link" data-scroll-target="#tris-à-plat-et-tris-croisés-compter-les-unités">Tris à plat et tris croisés : compter les unités</a></li>
  <li><a href="#calcul-des-pourcentages-dans-un-tri" id="toc-calcul-des-pourcentages-dans-un-tri" class="nav-link" data-scroll-target="#calcul-des-pourcentages-dans-un-tri">Calcul des pourcentages dans un tri</a>
  <ul class="collapse">
  <li><a href="#créer-une-nouvelle-colonne-qui-fait-la-division" id="toc-créer-une-nouvelle-colonne-qui-fait-la-division" class="nav-link" data-scroll-target="#créer-une-nouvelle-colonne-qui-fait-la-division">Créer une nouvelle colonne qui fait la division</a></li>
  <li><a href="#les-pourcentages-dans-les-sous-populations" id="toc-les-pourcentages-dans-les-sous-populations" class="nav-link" data-scroll-target="#les-pourcentages-dans-les-sous-populations">Les pourcentages dans les sous-populations</a></li>
  </ul></li>
  <li><a href="#la-mise-en-forme-des-tableaux" id="toc-la-mise-en-forme-des-tableaux" class="nav-link" data-scroll-target="#la-mise-en-forme-des-tableaux">La mise en forme des tableaux</a>
  <ul class="collapse">
  <li><a href="#changer-le-format-dun-tableau" id="toc-changer-le-format-dun-tableau" class="nav-link" data-scroll-target="#changer-le-format-dun-tableau">Changer le format d’un tableau</a></li>
  <li><a href="#mettre-en-forme" id="toc-mettre-en-forme" class="nav-link" data-scroll-target="#mettre-en-forme">Mettre en forme</a></li>
  </ul></li>
  <li><a href="#la-visualisation-de-données-avec-ggplot2---la-logique-additive" id="toc-la-visualisation-de-données-avec-ggplot2---la-logique-additive" class="nav-link" data-scroll-target="#la-visualisation-de-données-avec-ggplot2---la-logique-additive">La visualisation de données avec ggplot2 - La logique additive</a>
  <ul class="collapse">
  <li><a href="#la-logique-additive---les-variable-catégorielles" id="toc-la-logique-additive---les-variable-catégorielles" class="nav-link" data-scroll-target="#la-logique-additive---les-variable-catégorielles">La logique additive - Les variable catégorielles</a></li>
  <li><a href="#cohérence-entre-les-données-le-type-de-graphique-et-le-code" id="toc-cohérence-entre-les-données-le-type-de-graphique-et-le-code" class="nav-link" data-scroll-target="#cohérence-entre-les-données-le-type-de-graphique-et-le-code">Cohérence entre les données, le type de graphique et le code</a></li>
  <li><a href="#distinguer-les-paramètres-liés-aux-variables-et-les-paramètres-indépendants" id="toc-distinguer-les-paramètres-liés-aux-variables-et-les-paramètres-indépendants" class="nav-link" data-scroll-target="#distinguer-les-paramètres-liés-aux-variables-et-les-paramètres-indépendants">Distinguer les paramètres liés aux variables et les paramètres indépendants</a></li>
  <li><a href="#les-variables-catégorielles-à-plus-de-deux-modalités" id="toc-les-variables-catégorielles-à-plus-de-deux-modalités" class="nav-link" data-scroll-target="#les-variables-catégorielles-à-plus-de-deux-modalités">Les variables catégorielles à plus de deux modalités</a></li>
  <li><a href="#modifier-le-texte-et-les-légendes" id="toc-modifier-le-texte-et-les-légendes" class="nav-link" data-scroll-target="#modifier-le-texte-et-les-légendes">Modifier le texte et les légendes</a></li>
  </ul></li>
  <li><a href="#la-visualisation-de-données-avec-ggplot2---choisir-la-représentation-adéquate" id="toc-la-visualisation-de-données-avec-ggplot2---choisir-la-représentation-adéquate" class="nav-link" data-scroll-target="#la-visualisation-de-données-avec-ggplot2---choisir-la-représentation-adéquate">La visualisation de données avec ggplot2 - Choisir la représentation adéquate</a>
  <ul class="collapse">
  <li><a href="#changer-la-position-des-barres-superposées" id="toc-changer-la-position-des-barres-superposées" class="nav-link" data-scroll-target="#changer-la-position-des-barres-superposées">Changer la position des barres superposées</a></li>
  <li><a href="#représenter-des-distributions-en-pourcentages" id="toc-représenter-des-distributions-en-pourcentages" class="nav-link" data-scroll-target="#représenter-des-distributions-en-pourcentages">Représenter des distributions en pourcentages</a></li>
  </ul></li>
  <li><a href="#la-visualisation-de-données-avec-ggplot2---les-variables-numériques" id="toc-la-visualisation-de-données-avec-ggplot2---les-variables-numériques" class="nav-link" data-scroll-target="#la-visualisation-de-données-avec-ggplot2---les-variables-numériques">La visualisation de données avec ggplot2 - les variables numériques</a>
  <ul class="collapse">
  <li><a href="#les-distributions-à-laide-des-boîtes-à-moustache" id="toc-les-distributions-à-laide-des-boîtes-à-moustache" class="nav-link" data-scroll-target="#les-distributions-à-laide-des-boîtes-à-moustache">Les distributions à l’aide des boîtes à moustache</a></li>
  <li><a href="#combiner-plusieurs-graphiques" id="toc-combiner-plusieurs-graphiques" class="nav-link" data-scroll-target="#combiner-plusieurs-graphiques">Combiner plusieurs graphiques</a></li>
  <li><a href="#transformer-des-données-numériques-avant-de-les-représenter" id="toc-transformer-des-données-numériques-avant-de-les-représenter" class="nav-link" data-scroll-target="#transformer-des-données-numériques-avant-de-les-représenter">Transformer des données numériques avant de les représenter</a></li>
  <li><a href="#la-fonction-summarize" id="toc-la-fonction-summarize" class="nav-link" data-scroll-target="#la-fonction-summarize">La fonction <code>summarize</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Séance 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="acquis-des-premières-et-deuxièmes-séances-programme-du-jour" class="level2">
<h2 class="anchored" data-anchor-id="acquis-des-premières-et-deuxièmes-séances-programme-du-jour">Acquis des premières et deuxièmes séances, programme du jour</h2>
<p>La première séance a introduit le langage de programmation R et l’interface RStudio. La deuxième séance a introduit l’univers tidyverse à l’aide de l’exemple du cours au collège de France de François Héran.<br>
L’objectif est de devenir capable de transformer un tableau de données pour passer de l’information brute à l’analyse de données. La méthode présentée dans ce cours consiste à décomposer et enchaîner les opérations nécessaires à la production de statistiques et de graphiques. Elle demande un temps d’apprentissage plus long que les fonctions synthétiques. Une fois les bases acquises, vous aurez néanmoins la possibilité d’adapter facilement votre code aux traitements statistiques qui vous intéressent.<br>
Cette troisième séance reviendra d’abord sur la production de tri à plats et de tri croisés puis sur la visualisation des données.</p>
</section>
<section id="tris-à-plat-et-tris-croisés-compter-les-unités" class="level2">
<h2 class="anchored" data-anchor-id="tris-à-plat-et-tris-croisés-compter-les-unités">Tris à plat et tris croisés : compter les unités</h2>
<p>Réaliser un tri à plat ou un tri croisé consiste simplement à compter les individus qui appartiennent à des catégories plus ou moins spécifiques. Le tri à plat compte sur une dimension : le nombre d’hommes et le nombre de femmes. Le tri croisé ajoute une ou plusieurs dimensions : le nombre d’hommes agriculteurs et le nombre de femmes agricultrices. Rappel : La fonction <code>count</code> compte la variable donnée. Indiquer plusieurs variables revient à faire un tri croisé, soit compter des effectifs dans des catégories toujours plus précises. L’argument <code>wt =</code> permet d’indiquer les poids des individus.</p>
<p>Reprenons l’exemple du recensement de la population lyonnaise en 2009 et 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regardons à nouveau la structure de l'extrait du recensement</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [377,833 x 12] (S3: tbl_df/tbl/data.frame)
 $ annee          : Factor w/ 2 levels "2009","2019": 2 2 2 2 2 2 2 2 2 2 ...
 $ ARM            : num [1:377833] 69388 69388 69388 69384 69383 ...
 $ IPONDI         : num [1:377833] 1.178 1.178 1.178 2.965 0.956 ...
 $ CS1            : Factor w/ 8 levels "1","2","3","4",..: 8 3 8 8 8 4 5 8 4 6 ...
 $ IMMI           : Factor w/ 2 levels "Pas immigré.e",..: 1 1 1 2 1 1 1 1 1 1 ...
 $ SEXE           : Factor w/ 2 levels "Femme","Homme": 2 1 2 1 2 2 1 2 1 2 ...
 $ AGEREV         : num [1:377833] 14 43 11 85 23 28 50 23 23 21 ...
 $ NPERR          : num [1:377833] 3 3 3 1 1 1 1 2 2 1 ...
 $ NBPI           : num [1:377833] 3 3 3 4 1 1 2 1 1 3 ...
 $ LPRM           : Factor w/ 10 levels "1","2","3","4",..: 3 1 3 1 1 1 1 1 2 1 ...
 $ arrondissements: Factor w/ 9 levels "1er","2nd","3e",..: 8 8 8 4 3 8 4 3 3 3 ...
 $ csp            : Factor w/ 8 levels "Agriculteurs exploitants",..: 8 3 8 8 8 4 5 8 4 6 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La variable annee est un facteur à deux modalités</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rp<span class="sc">$</span>annee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(rp<span class="sc">$</span>annee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2009" "2019"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La variable IPONDI est une variable numérique</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rp<span class="sc">$</span>IPONDI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Complétez ce code pour compter la population lyonnaise en 2009 et 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, <span class="at">wt =</span> IPONDI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 x 2
  annee       n
  &lt;fct&gt;   &lt;dbl&gt;
1 2009  479787.
2 2019  522897.</code></pre>
</div>
</div>
<p>Complétez ce code pour compter la population lyonnaise par arrondissement en 2009 et 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, <span class="at">wt =</span> IPONDI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 x 3
   annee arrondissements       n
   &lt;fct&gt; &lt;fct&gt;             &lt;dbl&gt;
 1 2009  1er              28283.
 2 2009  2nd              30518.
 3 2009  3e               95463.
 4 2009  4e               35057.
 5 2009  5e               46797.
 6 2009  6e               49141.
 7 2009  7e               69163.
 8 2009  8e               76781.
 9 2009  9e               48584.
10 2019  1er              29648.
11 2019  2nd              31298.
12 2019  3e              102721.
13 2019  4e               36051.
14 2019  5e               49670.
15 2019  6e               52850.
16 2019  7e               82546.
17 2019  8e               86136.
18 2019  9e               51977.</code></pre>
</div>
</div>
<p>Complétez ce code pour compter la population lyonnaise par arrondissement et par sexe en 2009 et 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 x 4
   annee arrondissements SEXE       n
   &lt;fct&gt; &lt;fct&gt;           &lt;fct&gt;  &lt;dbl&gt;
 1 2009  1er             Femme 14733.
 2 2009  1er             Homme 13550.
 3 2009  2nd             Femme 16078.
 4 2009  2nd             Homme 14440.
 5 2009  3e              Femme 50754.
 6 2009  3e              Homme 44709.
 7 2009  4e              Femme 18980.
 8 2009  4e              Homme 16076.
 9 2009  5e              Femme 25680.
10 2009  5e              Homme 21117.
# i 26 more rows</code></pre>
</div>
</div>
</section>
<section id="calcul-des-pourcentages-dans-un-tri" class="level2">
<h2 class="anchored" data-anchor-id="calcul-des-pourcentages-dans-un-tri">Calcul des pourcentages dans un tri</h2>
<section id="créer-une-nouvelle-colonne-qui-fait-la-division" class="level3">
<h3 class="anchored" data-anchor-id="créer-une-nouvelle-colonne-qui-fait-la-division">Créer une nouvelle colonne qui fait la division</h3>
<p>On peut obtenir des pourcentages en divisant la population dans la sous-catégorie par la population totale. On utilise la fonction <code>mutate</code> pour créer une nouvelle variable. On l’associe à la fonction <code>sum</code> pour calculer la populaton totale.</p>
<p>Complétez ce code pour calculer la part de chaque arrondissement dans la population lyonnaise en 2019</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(arrondissements, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 x 3
  arrondissements       n      p
  &lt;fct&gt;             &lt;dbl&gt;  &lt;dbl&gt;
1 1er              57931. 0.0578
2 2nd              61816. 0.0617
3 3e              198183. 0.198 
4 4e               71108. 0.0709
5 5e               96467. 0.0962
6 6e              101991. 0.102 
7 7e              151709. 0.151 
8 8e              162917. 0.162 
9 9e              100561. 0.100 </code></pre>
</div>
</div>
</section>
<section id="les-pourcentages-dans-les-sous-populations" class="level3">
<h3 class="anchored" data-anchor-id="les-pourcentages-dans-les-sous-populations">Les pourcentages dans les sous-populations</h3>
<p>La définition de la population totale dépend du type de pourcentage que vous voulez calculer. Il faudra modifier en conséquence votre code pour que la fonction <code>sum</code> n’additionne pas toutes les lignes du tableau !<br>
Par exemple :</p>
<ul>
<li><p>Au numérateur, le nombre de femmes habitant dans le 1er arrondissement de Lyon en 2019.</p></li>
<li><p>Au dénominateur</p>
<ul>
<li><p>Le nombre d’habitant.es dans le 1er arrondissement de Lyon en 2019. On obtient la part femmes dans l’arrondissement.<br>
Il faudra faire la somme de la population au sein de chaque arrondissement à une année donnée, soit indiquer <code>group_by(annee, ARM)</code></p></li>
<li><p>Le nombre d’habitant.es à Lyon en 2019. On obtient la part que représentent les femmes du 1er arrondissement dans la population lyonnaise.<br>
Il faudra faire la somme de la population pour chaque année uniquement, soit indiquer <code>group_by(annee)</code></p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quelle est la part de femmes dans le premier arrondissement lyonnais en 2019 ?</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee, arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="st">"2019"</span> <span class="sc">&amp;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           arrondissements <span class="sc">==</span> <span class="st">"1er"</span> <span class="sc">&amp;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>           SEXE <span class="sc">==</span> <span class="st">"Femme"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 5
  annee arrondissements SEXE       n     p
  &lt;fct&gt; &lt;fct&gt;           &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 2019  1er             Femme 15115. 0.510</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Il y a 51,0% de femmes dans le 1er arrondissement en 2019.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Quelle part représentent les femmes du premier arrondissement parmi la population lyonnaise en 2019 ?</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="st">"2019"</span> <span class="sc">&amp;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>           arrondissements <span class="sc">==</span> <span class="st">"1er"</span> <span class="sc">&amp;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>           SEXE <span class="sc">==</span> <span class="st">"Femme"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 5
  annee arrondissements SEXE       n      p
  &lt;fct&gt; &lt;fct&gt;           &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 2019  1er             Femme 15115. 0.0289</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les femmes du 1er arrondissement représentent 2,9% de la population lyonnaise en 2019.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="la-mise-en-forme-des-tableaux" class="level2">
<h2 class="anchored" data-anchor-id="la-mise-en-forme-des-tableaux">La mise en forme des tableaux</h2>
<section id="changer-le-format-dun-tableau" class="level3">
<h3 class="anchored" data-anchor-id="changer-le-format-dun-tableau">Changer le format d’un tableau</h3>
<p>Les tableaux obtenus deviennent rapidement trop longs pour être lisibles. La présentation habituelle des tableaux croisés consiste à indiquer les modalités de la variable 1 en ligne et les modalités de la variable 2 en colonnes. C’est la fonction <code>pivot_wider</code> qui permet de transformer un tableau long en un tableau large.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La part d'hommes et de femmes par arrondissement en 2019</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Code pour obtenir le tableau sous format long</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee, arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>annee, <span class="sc">-</span>n) <span class="co"># On enlève la colonne des effectifs pour ne garder que les pourcentages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 x 3
   arrondissements SEXE      p
   &lt;fct&gt;           &lt;fct&gt; &lt;dbl&gt;
 1 1er             Femme 0.510
 2 1er             Homme 0.490
 3 2nd             Femme 0.532
 4 2nd             Homme 0.468
 5 3e              Femme 0.528
 6 3e              Homme 0.472
 7 4e              Femme 0.541
 8 4e              Homme 0.459
 9 5e              Femme 0.539
10 5e              Homme 0.461
11 6e              Femme 0.539
12 6e              Homme 0.461
13 7e              Femme 0.521
14 7e              Homme 0.479
15 8e              Femme 0.534
16 8e              Homme 0.466
17 9e              Femme 0.523
18 9e              Homme 0.477</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Il faut rajouter une fonction pour l'élargir</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Ici en mettant le sexe en colonne et l'arrondissement en ligne</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee, arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>annee, <span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> SEXE, <span class="co"># La variable qui donnera leur nom aux colonnes du tableau élargi</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> p <span class="co"># La variable qui donnera les valeurs à mettre dans les colonnes</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 x 3
  arrondissements Femme Homme
  &lt;fct&gt;           &lt;dbl&gt; &lt;dbl&gt;
1 1er             0.510 0.490
2 2nd             0.532 0.468
3 3e              0.528 0.472
4 4e              0.541 0.459
5 5e              0.539 0.461
6 6e              0.539 0.461
7 7e              0.521 0.479
8 8e              0.534 0.466
9 9e              0.523 0.477</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Là en mettant l'arrondissement en colonne et le sexe en ligne</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Ce n'est pas la présentation habituelle car on regarde la proportion d'hommes et de femmes</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Mais ce format est parfois nécessaire pour que les tableaux rentrent dans le document final</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee, arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>annee, <span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> arrondissements, <span class="co"># La variable qui donnera leur nom aux colonnes du tableau élargi</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> p <span class="co"># La variable qui donnera les valeurs à mettre dans les colonnes</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 x 10
  SEXE  `1er` `2nd`  `3e`  `4e`  `5e`  `6e`  `7e`  `8e`  `9e`
  &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Femme 0.510 0.532 0.528 0.541 0.539 0.539 0.521 0.534 0.523
2 Homme 0.490 0.468 0.472 0.459 0.461 0.461 0.479 0.466 0.477</code></pre>
</div>
</div>
</section>
<section id="mettre-en-forme" class="level3">
<h3 class="anchored" data-anchor-id="mettre-en-forme">Mettre en forme</h3>
<p>La mise en forme des tableaux sur R et leur exportation demande de nombreuses étapes supplémentaires. Le plus simple pour vous pourrait être de construire votre tableau en recopiant à la main les valeurs sans faire d’erreurs, ou bien utiliser la fonction <code>View()</code> et copier coller les valeurs dans un logiciel de traitement de texte (Word ou Libre Office Writer) ou un tableur (Excel ou Libre Office Calc). N’oubliez pas d’ajouter les parts dans l’ensemble de la population pour comparer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  rp <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, arrondissements, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee, arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>annee, <span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> SEXE,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> p</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># View(tab)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Je calcule les parts dans l'ensemble de la population, soit juste la part d'hommes et la part de femmes dans la population lyonnaise en 2019.</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(annee, SEXE, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span> <span class="co"># Ici j'ai enlevé le croisement avec les arrondissements pour le compte des effectifs</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(annee) <span class="sc">%&gt;%</span> <span class="co"># Je calcule les parts sans le croisement avec les arrondissements</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(annee <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>annee, <span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 x 2
  SEXE      p
  &lt;fct&gt; &lt;dbl&gt;
1 Femme 0.530
2 Homme 0.470</code></pre>
</div>
</div>
</section>
</section>
<section id="la-visualisation-de-données-avec-ggplot2---la-logique-additive" class="level2">
<h2 class="anchored" data-anchor-id="la-visualisation-de-données-avec-ggplot2---la-logique-additive">La visualisation de données avec ggplot2 - La logique additive</h2>
<section id="la-logique-additive---les-variable-catégorielles" class="level3">
<h3 class="anchored" data-anchor-id="la-logique-additive---les-variable-catégorielles">La logique additive - Les variable catégorielles</h3>
<p>Le package <code>ggplot2</code> permet de faire l’essentiel de la représentation graphique des données. Il a l’avantage de fonctionner selon une logique proche à l’enchaînement des opérations du l’univers tidyverse, sauf qu’il additionne des couches avec l’opérateur <code>+</code> quand les verbes de dplyr enchaînaient des fonctions avec l’opérateur <code>%&gt;%</code>.</p>
<ul>
<li><p>La fonction <code>ggplot</code> permet de déclarer les données sur lesquelles on va travailler.</p></li>
<li><p>Les fonctions de la forme <code>geom_</code> permettent de produire des graphiques. On indique les variables à utiliser à l’intérieur de la fonction <code>aes()</code>.</p></li>
<li><p>D’autres fonctions permettent de paramétrer le graphique, ajouter des légendes et d’autres modifications.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créons un tableau avec les seules données du RP de 2019</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>rp19 <span class="ot">&lt;-</span> <span class="fu">filter</span>(rp, annee <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Créons un diagramme en bâtons de la population des arrondissements lyonnais</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cohérence-entre-les-données-le-type-de-graphique-et-le-code" class="level3">
<h3 class="anchored" data-anchor-id="cohérence-entre-les-données-le-type-de-graphique-et-le-code">Cohérence entre les données, le type de graphique et le code</h3>
<p>Le graphique ci-dessus est un exemple très commun des problèmes qui émergent quand on ne s’assure pas de la cohérence entre les données dont on dispose, le type de graphique qu’on construit et le code qu’on écrit. Il faut toujours régler les problèmes au fur et à mesure, c’est la seule façon d’isoler les problèmes et de les régler efficacement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans la version précédente de ce code, la variable non recodée des arrondissements était utilisée</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rp19<span class="sc">$</span>ARM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les arrondissements sont considérés comme des valeurs numériques.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Il faut les convertir en facteurs. Profitons-en pour recoder.</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>rp19 <span class="ot">&lt;-</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  rp19 <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrondissements =</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">case_when</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69381</span> <span class="sc">~</span> <span class="st">"1er"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69382</span> <span class="sc">~</span> <span class="st">"2nd"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69383</span> <span class="sc">~</span> <span class="st">"3e"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69384</span> <span class="sc">~</span> <span class="st">"4e"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69385</span> <span class="sc">~</span> <span class="st">"5e"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69386</span> <span class="sc">~</span> <span class="st">"6e"</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69387</span> <span class="sc">~</span> <span class="st">"7e"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69388</span> <span class="sc">~</span> <span class="st">"8e"</span>,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>          ARM <span class="sc">==</span> <span class="dv">69389</span> <span class="sc">~</span> <span class="st">"9e"</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1er"</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"2nd"</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"3e"</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4e"</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"5e"</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6e"</span>,</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"7e"</span>,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8e"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"9e"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie notre recodage</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(rp19<span class="sc">$</span>arrondissements)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1er" "2nd" "3e"  "4e"  "5e"  "6e"  "7e"  "8e"  "9e" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le graphique actualisé</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Sachant que la fonction pour représenter des histogrammes (pour les variables quantitatives) est <code>geom_histogram</code> et que la variable de l’âge des individus rencensés est <code>AGEREV</code>, vérifiez que la variable d’âge est de la bonne classe d’objet et construisez un histogramme qui représente la distribution des âges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rp19<span class="sc">$</span>AGEREV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGEREV))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="distinguer-les-paramètres-liés-aux-variables-et-les-paramètres-indépendants" class="level3">
<h3 class="anchored" data-anchor-id="distinguer-les-paramètres-liés-aux-variables-et-les-paramètres-indépendants">Distinguer les paramètres liés aux variables et les paramètres indépendants</h3>
<p>Il faut bien distinguer deux types de commandes données aux fonctions <code>geom_</code>. Celles à l’intérieur de <code>aes</code> vont interroger les données pour produire quelque chose : compter les effectifs des modalités d’une variable, différencier la coulour ou la forme des points selon les modalités d’une variable etc. Les arguments à l’extérieur de <code>aes</code> s’appliquent uniformément à tous les éléments du graphique.</p>
<p>Avant de le montrer en graphique, recodez la variable <code>SEXE</code> en facteur. La valeur 1 correspond aux hommes et 2 aux femmes. Faites en sorte que la modalité “Femme” soit la première modalité du nouveau facteur plutôt que l’inverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="ot">&lt;-</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  rp19 <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEXE =</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(SEXE <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Homme"</span>, <span class="st">"Femme"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Femme"</span>, <span class="st">"Homme"</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> SEXE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> SEXE,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> IPONDI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rp19) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> IMMI,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> IPONDI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="les-variables-catégorielles-à-plus-de-deux-modalités" class="level3">
<h3 class="anchored" data-anchor-id="les-variables-catégorielles-à-plus-de-deux-modalités">Les variables catégorielles à plus de deux modalités</h3>
<p>Représentez la population de chaque arrondissement et sa composition socio-professionnelle en excluant les agriculteur.ices, les retraité.es et les inacti.f.ves.</p>
<table class="table">
<caption>Dictionnaire des codes de la variable CS1</caption>
<thead>
<tr class="header">
<th>Code</th>
<th>Modalité</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Agriculteurs exploitants</td>
</tr>
<tr class="even">
<td>2</td>
<td>Artisans, commerçants et chefs d’entreprise</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Cadres et professions intellectuelles supérieures</td>
</tr>
<tr class="even">
<td>4</td>
<td>Professions Intermédiaires</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Employés</td>
</tr>
<tr class="even">
<td>6</td>
<td>Ouvriers</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Retraités</td>
</tr>
<tr class="even">
<td>8</td>
<td>Inactifs</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="ot">&lt;-</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  rp19 <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">csp =</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fct</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">case_when</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Agriculteurs exploitants"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Artisans, commerçants et chefs d'entreprise"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Cadres et professions intellectuelles supérieures"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Professions intermédiaires"</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Employés"</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Ouvriers"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Retraités"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>          CS1 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Inactifs"</span>),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Agriculteurs exploitants"</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Artisans, commerçants et chefs d'entreprise"</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Cadres et professions intellectuelles supérieures"</span>,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Professions intermédiaires"</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Employés"</span>,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Ouvriers"</span>,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Retraités"</span>,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Inactifs"</span>)</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(csp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Agriculteurs exploitants"</span>, </span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Retraités"</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Inactifs"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> csp,</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> IPONDI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modifier-le-texte-et-les-légendes" class="level3">
<h3 class="anchored" data-anchor-id="modifier-le-texte-et-les-légendes">Modifier le texte et les légendes</h3>
<p>Il faut ensuite ajouter tous les éléments nécessaires à la bonne lecture d’un graphique. On choisit des couleurs à l’aide du site <a href="https://colorbrewer2.org/">ColorBrewer</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Je créer un vecteur nommé, c'est-à-dire que je donne un nom à chacune des valeurs.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>couleurs_csp <span class="ot">&lt;-</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Artisans, commerçants et chefs d'entreprise"</span> <span class="ot">=</span> <span class="st">"#ffffbf"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cadres et professions intellectuelles supérieures"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Professions intermédiaires"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Employés"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ouvriers"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Je construis mon graphique en filtrant d'abord les données</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">filter</span>(rp19, <span class="sc">!</span>(csp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Agriculteurs exploitants"</span>, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Retraités"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Inactifs"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> csp,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> IPONDI))</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>graph <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Je rajoute les légendes</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="co"># Fonction qui permet de définir les titres et textes</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population et composition socio-professionnelle des arrondissements lyonnais en 2019"</span>,</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Arrondissement"</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effectifs"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Catégorie socio-professionnelle"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Champ : actif.ves sauf agriculteur.ices</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="st">    Lecture : en 2019, il y avait 18 000 habitant.es dans le premier arrondissement de Lyon.</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="st">    La majorité des habitant.es appartiennent à la catégorie des cadres et des professions intellectuelles supérieures</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="st">    Recensement de la population 2019 | A. POISSONNIER | 2023"</span>) <span class="sc">+</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Je change les couleurs et le thème graphique</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> couleurs_csp,</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span> </span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">byrow =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
<section id="la-visualisation-de-données-avec-ggplot2---choisir-la-représentation-adéquate" class="level2">
<h2 class="anchored" data-anchor-id="la-visualisation-de-données-avec-ggplot2---choisir-la-représentation-adéquate">La visualisation de données avec ggplot2 - Choisir la représentation adéquate</h2>
<section id="changer-la-position-des-barres-superposées" class="level3">
<h3 class="anchored" data-anchor-id="changer-la-position-des-barres-superposées">Changer la position des barres superposées</h3>
<p>La lisibilité d’un graphique et le risque qu’il amène des erreurs d’interprétation est très différent selon la façon dont on représente l’information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Je créer un vecteur nommé, c'est-à-dire que je donne un nom à chacune des valeurs.</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>couleurs_csp <span class="ot">&lt;-</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Artisans, commerçants et chefs d'entreprise"</span> <span class="ot">=</span> <span class="st">"#ffffbf"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cadres et professions intellectuelles supérieures"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Professions intermédiaires"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Employés"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ouvriers"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Je construis mon graphique en filtrant d'abord les données</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">filter</span>(rp19, <span class="sc">!</span>(csp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Agriculteurs exploitants"</span>, </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Retraités"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Inactifs"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> csp,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> IPONDI),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Je rajoute les légendes</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>graph <span class="sc">+</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="co"># Fonction qui permet de définir les titres et textes</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population et composition socio-professionnelle des arrondissements lyonnais en 2019"</span>,</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Arrondissement"</span>,</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effectifs"</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Catégorie socio-professionnelle"</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Champ : actif.ves sauf agriculteur.ices</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="st">    Lecture : en 2019, il y avait 18 000 habitant.es dans le premier arrondissement de Lyon.</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="st">    La majorité des habitant.es appartiennent à la catégorie des cadres et des professions intellectuelles supérieures</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="st">    Recensement de la population 2019 | A. POISSONNIER | 2023"</span>) <span class="sc">+</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Je change les couleurs et le thème graphique</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> couleurs_csp,</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span> </span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>                             <span class="at">byrow =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="représenter-des-distributions-en-pourcentages" class="level3">
<h3 class="anchored" data-anchor-id="représenter-des-distributions-en-pourcentages">Représenter des distributions en pourcentages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Je créer un vecteur nommé, c'est-à-dire que je donne un nom à chacune des valeurs.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>couleurs_csp <span class="ot">&lt;-</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"Artisans, commerçants et chefs d'entreprise"</span> <span class="ot">=</span> <span class="st">"#ffffbf"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cadres et professions intellectuelles supérieures"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Professions intermédiaires"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Employés"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ouvriers"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Je construis mon graphique en filtrant d'abord les données</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  rp19 <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(csp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Agriculteurs exploitants"</span>, </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Retraités"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Inactifs"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(arrondissements, csp, <span class="at">wt =</span> IPONDI) <span class="sc">%&gt;%</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> arrondissements,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> p,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> csp),</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Je rajoute les légendes</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>graph <span class="sc">+</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="co"># Fonction qui permet de définir les titres et textes</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population et composition socio-professionnelle des arrondissements lyonnais en 2019"</span>,</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Arrondissement"</span>,</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Part (en %)"</span>,</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Catégorie socio-professionnelle"</span>,</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Champ : actif.ves sauf agriculteur.ices</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="st">    Lecture : en 2019, 39% des habitant.es du premier arrondissement de Lyon appartenaient à la catégorie cadres et professions intellectuelles supérieures.</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="st">    Recensement de la population 2019 | A. POISSONNIER | 2023"</span>) <span class="sc">+</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Je change les couleurs et le thème graphique</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> couleurs_csp,</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span> </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>                             <span class="at">byrow =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
<section id="la-visualisation-de-données-avec-ggplot2---les-variables-numériques" class="level2">
<h2 class="anchored" data-anchor-id="la-visualisation-de-données-avec-ggplot2---les-variables-numériques">La visualisation de données avec ggplot2 - les variables numériques</h2>
<section id="les-distributions-à-laide-des-boîtes-à-moustache" class="level3">
<h3 class="anchored" data-anchor-id="les-distributions-à-laide-des-boîtes-à-moustache">Les distributions à l’aide des boîtes à moustache</h3>
<p>Créez des boîtes à moustache à l’aide de la fonction <code>geom_boxplot</code> qui représente la distribution de l’âge en fonction de la variable <code>IMMI</code>. N’utilisez pas les poids cette fois-ci.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGEREV,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> IMMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> AGEREV,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> IMMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="combiner-plusieurs-graphiques" class="level3">
<h3 class="anchored" data-anchor-id="combiner-plusieurs-graphiques">Combiner plusieurs graphiques</h3>
<p>On souhaite parfois réaliser la même opération de visualisation mais le représenter dans des graphiques différents. Cela permet de distinguer les niveaux d’analyse à plus de deux dimensions. Il faut pour cela utiliser les fonctions <code>facet_</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproduire la comparaison des âges à 2 recensements mis côte-à-côte</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> AGEREV,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> IMMI)) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(annee))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut même créer des grilles avec plus d'un croisement</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>rp <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> AGEREV,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> IMMI)) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(SEXE), <span class="fu">vars</span>(annee))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="transformer-des-données-numériques-avant-de-les-représenter" class="level3">
<h3 class="anchored" data-anchor-id="transformer-des-données-numériques-avant-de-les-représenter">Transformer des données numériques avant de les représenter</h3>
<p>Nous avons déjà vu que les verbes de dplyr tel <code>mutate</code> changeaient leur fonctionnement si un groupement avait été annoncé avec <code>group_by</code>. Les variables <code>NBPI</code> et <code>NPERR</code> représentent respectivement le nombre de pièces et le nombre de personnes dans le logement habité par la personne recensée. La variable <code>LPRM</code> prend la valeur 1 quand la personne recensée est la personne de référence du logement. Créez une nouvelle colonne sur le tableau du recensement de 2019 du nombre de pièces et de personnes moyens par arrondissement. La fonction <code>weighted.mean</code> qui prend les arguments <code>x</code> pour le vecteur et <code>w</code> pour les poids vous permettra de tenir compte de la pondération.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LPRM <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moy_NBPI =</span> <span class="fu">weighted.mean</span>(<span class="at">x=</span> NBPI, <span class="at">w =</span> IPONDI),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">moy_NPERR =</span> <span class="fu">mean</span>(<span class="at">x =</span> NPERR, <span class="at">w =</span> IPONDI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 104,042 x 14
# Groups:   arrondissements [9]
   annee   ARM IPONDI CS1   IMMI  SEXE  AGEREV NPERR  NBPI LPRM  arrondissements
   &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;          
 1 2019  69388  1.18  3     Pas ~ Femme     43     3     3 1     8e             
 2 2019  69384  2.97  8     Immi~ Femme     85     1     4 1     4e             
 3 2019  69383  0.956 8     Pas ~ Femme     23     1     1 1     3e             
 4 2019  69388  1.07  4     Pas ~ Femme     28     1     1 1     8e             
 5 2019  69384  2.62  5     Pas ~ Femme     50     1     2 1     4e             
 6 2019  69383  3.02  8     Pas ~ Femme     23     2     1 1     3e             
 7 2019  69383  2.95  6     Pas ~ Femme     21     1     3 1     3e             
 8 2019  69382  2.88  3     Pas ~ Femme     29     1     2 1     2nd            
 9 2019  69389  0.941 5     Immi~ Femme     48     1     4 1     9e             
10 2019  69384  2.79  3     Pas ~ Femme     38     5     6 1     4e             
# i 104,032 more rows
# i 3 more variables: csp &lt;fct&gt;, moy_NBPI &lt;dbl&gt;, moy_NPERR &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="la-fonction-summarize" class="level3">
<h3 class="anchored" data-anchor-id="la-fonction-summarize">La fonction <code>summarize</code></h3>
<p>La fonction <code>summarize</code> permet de résumer cette information de groupe en un tableau synthétique.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LPRM <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">moy_NBPI =</span> <span class="fu">weighted.mean</span>(<span class="at">x=</span> NBPI, <span class="at">w =</span> IPONDI),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">moy_NPERR =</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> NPERR, <span class="at">w =</span> IPONDI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 x 3
  arrondissements moy_NBPI moy_NPERR
  &lt;fct&gt;              &lt;dbl&gt;     &lt;dbl&gt;
1 1er                 2.71      1.79
2 2nd                 2.98      1.86
3 3e                  2.88      1.89
4 4e                  3.09      1.93
5 5e                  3.34      1.96
6 6e                  3.07      1.90
7 7e                  2.59      1.75
8 8e                  2.93      1.91
9 9e                  3.08      2.02</code></pre>
</div>
</div>
<p>Représentez graphiquement cette information à l’aide de la fonction <code>geom_point</code> qui crée un nuage de points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LPRM <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> <span class="co"># La personne de référence du ménage</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">moy_NBPI =</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> NBPI, <span class="at">w =</span> IPONDI),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">moy_NPERR =</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> NPERR, <span class="at">w =</span> IPONDI)) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> moy_NBPI,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> moy_NPERR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Associez les points dans le plan en deux dimensions au nom des arrondissements en remplaçant <code>geom_point</code> par <code>geom_text</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rp19 <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LPRM <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> <span class="co"># La personne de référence du ménage</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(arrondissements) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">moy_NBPI =</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> NBPI, <span class="at">w =</span> IPONDI),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">moy_NPERR =</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> NPERR, <span class="at">w =</span> IPONDI)) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> moy_NBPI,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> moy_NPERR,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> arrondissements))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Seance3_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>