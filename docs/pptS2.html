<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analyse quantitative - M2 Villes et environnements urbains - Powerpoint - Séance 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Analyse quantitative - M2 Villes et environnements urbains</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Seance1.html" rel="" target="">
 <span class="menu-text">Séance 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Seance2.html" rel="" target="">
 <span class="menu-text">Séance 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./pptS2.html" rel="" target="" aria-current="page">
 <span class="menu-text">Powerpoint - Séance 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./rappel_S1S2.html" rel="" target="">
 <span class="menu-text">Rappel avant la troisième séance</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pourquoi-travailler-sur-le-fait-migratoire" id="toc-pourquoi-travailler-sur-le-fait-migratoire" class="nav-link active" data-scroll-target="#pourquoi-travailler-sur-le-fait-migratoire">Pourquoi travailler sur le fait migratoire</a></li>
  <li><a href="#le-fait-migratoire-daprès-les-graphiques-de-françois-héran" id="toc-le-fait-migratoire-daprès-les-graphiques-de-françois-héran" class="nav-link" data-scroll-target="#le-fait-migratoire-daprès-les-graphiques-de-françois-héran">Le fait migratoire d’après les graphiques de François Héran</a></li>
  <li><a href="#la-progression-mondiale" id="toc-la-progression-mondiale" class="nav-link" data-scroll-target="#la-progression-mondiale">La progression mondiale</a></li>
  <li><a href="#les-titres-de-séjour" id="toc-les-titres-de-séjour" class="nav-link" data-scroll-target="#les-titres-de-séjour">Les titres de séjour</a></li>
  <li><a href="#les-titres-de-séjours-familiaux" id="toc-les-titres-de-séjours-familiaux" class="nav-link" data-scroll-target="#les-titres-de-séjours-familiaux">Les titres de séjours familiaux</a></li>
  <li><a href="#les-données-du-recensement-de-la-population" id="toc-les-données-du-recensement-de-la-population" class="nav-link" data-scroll-target="#les-données-du-recensement-de-la-population">Les données du recensement de la population</a></li>
  <li><a href="#opérations-nécessaires-pour-construire-les-graphiques-dévolution-du-nombre-et-de-la-proportion-dimmigré.es" id="toc-opérations-nécessaires-pour-construire-les-graphiques-dévolution-du-nombre-et-de-la-proportion-dimmigré.es" class="nav-link" data-scroll-target="#opérations-nécessaires-pour-construire-les-graphiques-dévolution-du-nombre-et-de-la-proportion-dimmigré.es">Opérations nécessaires pour construire les graphiques d’évolution du nombre et de la proportion d’immigré.es</a></li>
  <li><a href="#créer-une-variable-dimmigration" id="toc-créer-une-variable-dimmigration" class="nav-link" data-scroll-target="#créer-une-variable-dimmigration">Créer une variable d’immigration</a></li>
  <li><a href="#calculer-les-effectifs" id="toc-calculer-les-effectifs" class="nav-link" data-scroll-target="#calculer-les-effectifs">Calculer les effectifs</a></li>
  <li><a href="#calculer-les-pourcentages---1" id="toc-calculer-les-pourcentages---1" class="nav-link" data-scroll-target="#calculer-les-pourcentages---1">Calculer les pourcentages - 1</a></li>
  <li><a href="#calculer-les-pourcentages---2" id="toc-calculer-les-pourcentages---2" class="nav-link" data-scroll-target="#calculer-les-pourcentages---2">Calculer les pourcentages - 2</a></li>
  <li><a href="#construction-graphique" id="toc-construction-graphique" class="nav-link" data-scroll-target="#construction-graphique">Construction graphique</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="pptS2.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Powerpoint - Séance 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'

The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year

The following objects are masked from 'package:dplyr':

    between, first, last

The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
</div>
<section id="pourquoi-travailler-sur-le-fait-migratoire" class="level2">
<h2 class="anchored" data-anchor-id="pourquoi-travailler-sur-le-fait-migratoire">Pourquoi travailler sur le fait migratoire</h2>
<ul>
<li><p>Le droit des étranger.es est surtout droit contre les étranger.es : les moyens dont les États se dotent pour contrôler l’entrée et la vie des étranger.es sur son territoire</p></li>
<li><p>Le conflit entre la souveraineté Étatique et le droit des personnes pose un problème juridique parfois tranché grâce à la statistique. Proportionnalité du droit : les moyens de contrôle dérogatoires restent-ils légaux ?</p></li>
<li><p>Fabrication du droit de l’État lié à la conjoncture politique et la perception des flux migratoires</p></li>
</ul>
<div class="notes">
<ul>
<li><p>Construction d’un droit contre les étrangers plutôt que droit des étrangers, droit des États à contrôler les étrangers. Lien entre les décisions judiciaires et la perception du fait migratoire&nbsp;: puisque la souveraineté des États entre en conflit avec le droit des personnes, il y a une incertitude juridique sur le degré de contrôle légal et réalisable dans les faits, c’est-à-dire les moyens de coercion.</p></li>
<li><p>À partir de quel seuil les flux migratoires deviennent « massifs&nbsp;», et assez importants pour adopter des procédés dérogatoires sans enfreindre le principe de proportionnalité ?</p></li>
<li><p>Fabrication du droit de l’État lié à la conjoncture politique et la perception des flux migratoires</p></li>
<li><p>Fabrication du droit de l’État lié aux usages sociaux des statistiques par ceux qui pratiquent et produisent le droit (jurisprudence, interprétation des constitutions internationales, traités, droits nationaux, respect des procédures, situation d’urgence ..)</p></li>
</ul>
</div>
</section>
<section id="le-fait-migratoire-daprès-les-graphiques-de-françois-héran" class="level2">
<h2 class="anchored" data-anchor-id="le-fait-migratoire-daprès-les-graphiques-de-françois-héran">Le fait migratoire d’après les graphiques de François Héran</h2>
<p><img src="nb_prop_immig.png" class="img-fluid"></p>
<div class="notes">
<p><strong>Le graphique</strong></p>
<ul>
<li><p>Années 1850/1871&nbsp;: doublement, craintes très fortes des population allogènes alors qu’en proportion, ce n’est rien.</p></li>
<li><p>Fin XIXe, stagnation, grande crise, incidence directe des conditions économiques sur les flux migratoires.</p></li>
<li><p>Première Guerre Mondiale, données manquante (recensement tous les 5 ans). Appel massif aux étranger·es, plus seulement les voisin·es puisqu’on va chercher les Polonais·es (avant plutôt Belges, Allemand·es, Italien·nes, Suisses). Les charbonnages de France.</p></li>
<li><p>Crise des années 30, reflux très important, renvoi de + de 100&nbsp;000 polonais·es «&nbsp;manu militari&nbsp;»</p></li>
<li><p>Début années 50, les années de reconstruction et de rattrapage économique. 1974, stop à l’immigration de travail. Obsession de VGE avec les maghrébin·es, et d’autres haut·es fonctionnaires.</p></li>
<li><p>Depuis 2000, la migration progresse de façon rapide et constante. Recensement tournant, estimation annuelle.</p></li>
</ul>
<p><strong>Insister sur</strong></p>
<ul>
<li><p>les deux dimensions et les deux échelles (avec une légende chacune) ainsi que les effets d’optiques&nbsp;: rappeler les valeurs chiffrées, ordre de grandeur</p></li>
<li><p>sémiologie graphique&nbsp;: deux figurés, deux couleurs opposées avec cohérence des couleurs</p></li>
<li><p>la forme même du graphique&nbsp;: ce sont des points reliés par des droites, soit une «&nbsp;linéarisation&nbsp;» des niveaux mesurés à intervalles fixes</p></li>
<li><p>l’illusion de continuité&nbsp;: pour le coup, relative stabilité de la définition d’immigré·e, donc possible de remonter à longtemps</p></li>
<li><p>les ruptures&nbsp;: données manquantes, changement de mode de collecte</p></li>
<li><p>les légendes</p></li>
<li><p>Revenir après sur concrètement, à quoi ressemble le tableau du recensement et quelles opérations on doit faire pour arriver à un tableau qui contient toutes les informations nécessaires?</p></li>
</ul>
</div>
</section>
<section id="la-progression-mondiale" class="level2">
<h2 class="anchored" data-anchor-id="la-progression-mondiale">La progression mondiale</h2>
<p><img src="prog_immig.png" class="img-fluid"></p>
</section>
<section id="les-titres-de-séjour" class="level2">
<h2 class="anchored" data-anchor-id="les-titres-de-séjour">Les titres de séjour</h2>
<p><img src="titre_sej.png" class="img-fluid"></p>
</section>
<section id="les-titres-de-séjours-familiaux" class="level2">
<h2 class="anchored" data-anchor-id="les-titres-de-séjours-familiaux">Les titres de séjours familiaux</h2>
<p><img src="titre_sej_fam.png" class="img-fluid"></p>
</section>
<section id="les-données-du-recensement-de-la-population" class="level2">
<h2 class="anchored" data-anchor-id="les-données-du-recensement-de-la-population">Les données du recensement de la population</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="fragment">
<ul>
<li><p><em>La version anonymisée du recensement est en accès libre sur le site de l’INSEE. Plusieurs fichiers existent (niveau logement, niveau individu localisé à la région, au canton-ville) et censurent différents types d’information.</em></p></li>
<li><p><em>Les données harmonisées entre 1968 et 2019 permettent de créer des séries longues beaucoup plus simplement qu’en compilant les différents recensements.</em></p></li>
</ul>
</div>
</div><div class="column" style="width:40%;">
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51531264        4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rp, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    AN_RECENS POND REG_NAIS NATIO
 1:      1968 1568       84   000
 2:      1968   12       84   1ES
 3:      1968   40       84   1IT
 4:      1968    4       84   3DZ
 5:      1968 1696       84   000
 6:      1968    8       84   1ES
 7:      1968   24       84   1IT
 8:      1968   12       84   3DZ
 9:      1968 1432       84   000
10:      1968    4       84   1ES
11:      1968   28       84   1IT
12:      1968    4       84   1PT
13:      1968   16       84   3DZ
14:      1968 1604       84   000
15:      1968   16       84   1ES
16:      1968   32       84   1IT
17:      1968    4       84   1PT
18:      1968    4       84   3DZ
19:      1968    4       84   3TN
20:      1968 1616       84   000</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="opérations-nécessaires-pour-construire-les-graphiques-dévolution-du-nombre-et-de-la-proportion-dimmigré.es" class="level2">
<h2 class="anchored" data-anchor-id="opérations-nécessaires-pour-construire-les-graphiques-dévolution-du-nombre-et-de-la-proportion-dimmigré.es">Opérations nécessaires pour construire les graphiques d’évolution du nombre et de la proportion d’immigré.es</h2>
<ul>
<li><p>Créer une variable qui renseigne le statut d’immigration</p></li>
<li><p>Compter pour chaque année le nombre d’immigré.es (effectifs)</p></li>
<li><p>Diviser le nombre d’immigré.es par le nombre de français.es à une année donnée</p></li>
<li><p>Construire un graphique avec un abscisse pour les années et une ordonnée pour le nombre ou la proportion</p></li>
<li><p>Placer les points et les relier avec des traits</p></li>
<li><p>Ajouter des légendes</p></li>
</ul>
</section>
<section id="créer-une-variable-dimmigration" class="level2">
<h2 class="anchored" data-anchor-id="créer-une-variable-dimmigration">Créer une variable d’immigration</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="natio.PNG" class="img-fluid"></p>
</div><div class="column" style="width:50%;">
<p><img src="reg_nais.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="calculer-les-effectifs" class="level2">
<h2 class="anchored" data-anchor-id="calculer-les-effectifs">Calculer les effectifs</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Calculs</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rp[, IMMI <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(NATIO <span class="sc">!=</span> <span class="st">"000"</span> <span class="sc">&amp;</span> REG_NAIS <span class="sc">==</span> <span class="st">"99"</span>, <span class="dv">1</span>, <span class="dv">0</span>)]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>tab_eff <span class="ot">&lt;-</span> rp[, .(<span class="at">n =</span> <span class="fu">sum</span>(POND)), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"AN_RECENS"</span>, <span class="st">"IMMI"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Obtenir les effectifs absolus</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tab_eff <span class="ot">&lt;-</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  rp <span class="sc">%&gt;%</span> <span class="co"># Opérateur PIPE</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># Fonction pour créer une variable</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">IMMI =</span> <span class="co"># Nom de la variable</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(NATIO <span class="sc">!=</span> <span class="st">"000"</span> <span class="sc">&amp;</span> REG_NAIS <span class="sc">==</span> <span class="st">"99"</span>, <span class="co"># Condition</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Immigré.e"</span>, <span class="co"># Valeur si la conditin est vérifiée</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Pas immigré.e"</span>) <span class="co"># Valeur si la condition n'est pas vérifiée</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(AN_RECENS, IMMI, <span class="at">wt =</span> POND) <span class="co"># Compte des effectifs pondérés</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tab_eff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    AN_RECENS IMMI        n
 1:      1968    0 46416268
 2:      1968    1  3238284
 3:      1975    0 48711970
 4:      1975    1  3887460
 5:      1982    0 50258576
 6:      1982    1  4037036
 7:      1990    0 53855423
 8:      1990    1  4222237
 9:      1999    0 55769985
10:      1999    1  4374266
11:      2008    0 58588985
12:      2008    1  5347567
13:      2013    0 59729778
14:      2013    1  5835094
15:      2019    0 60469081
16:      2019    1  6515809</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="calculer-les-pourcentages---1" class="level2">
<h2 class="anchored" data-anchor-id="calculer-les-pourcentages---1">Calculer les pourcentages - 1</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tab_p <span class="ot">&lt;-</span> tab_eff <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AN_RECENS =</span> <span class="fu">as.factor</span>(AN_RECENS),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.by =</span> AN_RECENS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Obtenir les pourcentages</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tab_p <span class="ot">&lt;-</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  rp <span class="sc">%&gt;%</span> <span class="co"># Opérateur PIPE</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># Fonction pour créer une variable</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">IMMI =</span> <span class="co"># Nom de la variable</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(NATIO <span class="sc">!=</span> <span class="st">"000"</span> <span class="sc">&amp;</span> REG_NAIS <span class="sc">==</span> <span class="st">"99"</span>, <span class="co"># Condition</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Immigré.e"</span>, <span class="co"># Valeur si la conditin est vérifiée</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Pas immigré.e"</span>) <span class="co"># Valeur si la condition n'est pas vérifiée</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(AN_RECENS, IMMI, <span class="at">wt =</span> POND) <span class="sc">%&gt;%</span> <span class="co"># Compte des effectifs pondérés</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AN_RECENS) <span class="sc">%&gt;%</span> <span class="co"># Opération par année</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> <span class="co"># Part dans la population</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(IMMI <span class="sc">==</span> <span class="st">"Immigré.e"</span>) <span class="sc">%&gt;%</span> <span class="co"># On ne garde qu'une ligne sur deux</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>IMMI) <span class="co"># On enlève la colonne immigration</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tab_p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    AN_RECENS IMMI        n          p
 1:      1968    0 46416268 0.93478374
 2:      1968    1  3238284 0.06521626
 3:      1975    0 48711970 0.92609312
 4:      1975    1  3887460 0.07390688
 5:      1982    0 50258576 0.92564710
 6:      1982    1  4037036 0.07435290
 7:      1990    0 53855423 0.92730015
 8:      1990    1  4222237 0.07269985
 9:      1999    0 55769985 0.92727042
10:      1999    1  4374266 0.07272958
11:      2008    0 58588985 0.91636135
12:      2008    1  5347567 0.08363865
13:      2013    0 59729778 0.91100274
14:      2013    1  5835094 0.08899726
15:      2019    0 60469081 0.90272718
16:      2019    1  6515809 0.09727282</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="calculer-les-pourcentages---2" class="level2">
<h2 class="anchored" data-anchor-id="calculer-les-pourcentages---2">Calculer les pourcentages - 2</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tab_p <span class="ot">&lt;-</span> tab_eff <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AN_RECENS =</span> <span class="fu">as.factor</span>(AN_RECENS),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.by =</span> AN_RECENS) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(IMMI <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>IMMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tab_p <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  rp <span class="sc">%&gt;%</span> <span class="co"># Opérateur PIPE</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># Fonction pour créer une variable</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">IMMI =</span> <span class="co"># Nom de la variable</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(NATIO <span class="sc">!=</span> <span class="st">"000"</span> <span class="sc">&amp;</span> REG_NAIS <span class="sc">==</span> <span class="st">"99"</span>, <span class="co"># Condition</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Immigré.e"</span>, <span class="co"># Valeur si la conditin est vérifiée</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Pas immigré.e"</span>) <span class="co"># Valeur si la condition n'est pas vérifiée</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(AN_RECENS, IMMI, <span class="at">wt =</span> POND) <span class="sc">%&gt;%</span> <span class="co"># Compte des effectifs pondérés</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AN_RECENS) <span class="sc">%&gt;%</span> <span class="co"># Opération par année</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> <span class="co"># Part dans la population</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(IMMI <span class="sc">==</span> <span class="st">"Immigré.e"</span>) <span class="sc">%&gt;%</span> <span class="co"># On ne garde qu'une ligne sur deux</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>IMMI) <span class="co"># On enlève la colonne immigration</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:30%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tab_p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   AN_RECENS       n          p
1:      1968 3238284 0.06521626
2:      1975 3887460 0.07390688
3:      1982 4037036 0.07435290
4:      1990 4222237 0.07269985
5:      1999 4374266 0.07272958
6:      2008 5347567 0.08363865
7:      2013 5835094 0.08899726
8:      2019 6515809 0.09727282</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="construction-graphique" class="level2">
<h2 class="anchored" data-anchor-id="construction-graphique">Construction graphique</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Calculs</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> rp[, .(<span class="at">n =</span> <span class="fu">sum</span>(POND)), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"AN_RECENS"</span>, <span class="st">"IMMI"</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AN_RECENS =</span> <span class="fu">as.factor</span>(AN_RECENS),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.by =</span> AN_RECENS) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(IMMI <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AN_RECENS)) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> p,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> n<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">8</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">8</span>, <span class="at">name=</span><span class="st">"Nombre d'immigré·es"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">seq</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">7</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">labels =</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">7</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">5</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>), <span class="at">big.mark =</span> <span class="st">" "</span>)),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.005</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="fu">seq</span>(<span class="fl">0.00</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.005</span>),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decimal.mark =</span> <span class="st">","</span>),</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">"Part d'immigré·es"</span>) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">levels</span>(tab<span class="sc">$</span>AN_RECENS),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Année"</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nombre et proportion d'immigré·es en France depuis 1968"</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source : RP 1968-2019 (données harmonisées) | 2023 | A. Poissonnier</span><span class="sc">\n</span><span class="st">Lecture : en 1968, il y avait 3 250 000 immigré·es en France et la part de proportion immigrée dans la population française était de 6,50%.  "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pptS2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>